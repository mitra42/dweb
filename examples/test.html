<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Test page for Dweb</title>
    <!--<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>-->
    <script src="http://localhost:4243/file/sb/SHA3256B64URL.BDCbn_l9rrlCdVkB9o6qozSP84HBCGors5dBLxdyro8="></script><!-- jquery-3.1.1.js-->
    <!--<script src="http://localhost:4243/file/mb/SHA3256B64URL.OylzjhbKQK5VOVMbvdK9Dkb4UDfOEHU8uCeSnzqiseE="></script>--><!-- dweb.js -->
    <script>
        // This is code intended to go in library when working
        // ====== IN PROGRESS BELOW HERE
        var dwebserver = 'localhost'
        var dwebport = '4243'

        class TransportHttp {

            constructor(ipandport, options) {
                this.ipandport = ipandport;
                this.options = options; // Dictionary of options, currently unused
                this.baseurl = "http://" + ipandport[0] + ":" + ipandport[1] + "/";
            }

            static setup(ipandport, options) {
                return new TransportHttp(ipandport, options);
            }

            url(command, table, hash) {
                var url = this.baseurl + command + "/" + table + "/" + hash;
                return url;
            }
        }

        var transport = TransportHttp.setup([dwebserver, dwebport], {});

        class Block {

            constructor(hash, data) {
                this._hash = hash;  // Maybe null
                this._data = data;  // Maybe null
                this.table = 'b';
            }

            block(table, verbose, options) {
                // table: overrides table of class
                // options: { dom_id:   id to put data retrieved.
                //TODO probably move this into transportHttp but leave success and failure out passing as parameters
                // Based on python except table is reqd parameter (null not acceptable)
                // Locate and return a block, based on its multihash
                if (verbose) { console.log("Fetching block: table=", table || this.table, "hash=", this._hash); }
                let url = transport.url("block", table || this.table, this._hash);
                alert(url);
                if (verbose) { console.log("Fetching block: url=",url); }
                $.ajax({
                    type: "GET",
                    url: url,
                    success: function(data) {
                        if (verbose) { console.log("Block returning data len=", data.length); }
                        if (options["dom_id"]) { document.getElementById(options["dom_id"]).innerHTML = data; } // TODO make it handle img, or other non-HTML as reqd
                    },
                    error: function(xhr, status, error) {
                        alert("TODO Block failure status="+status+" error="+error);
                    },
                });
            }
        }

    </script>
    <script>
        // This is my current testing script.
        b = new Block("SHA3256B64URL.50GNWgUQ9GgrVfMvpedEg77ByMRYkUgPRU9P1gWaNF8=", null)
        b.block(null, true, {"dom_id": "myList.0"});      // Load block in background
        //foo.load("myList.0");
    </script>


</head>
<body>
<H1>Test page for DWEB</H1>
<p>This page is a current test, will just be testing current (usually broken) stuff.</p>

<ul id="myList"><li id="myList.0">Initial unreplaced text</li><li id="mylist.1">Dummy text of item1</li></ul>
</body>
</html>

